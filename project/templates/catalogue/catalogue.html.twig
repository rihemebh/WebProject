{% extends 'baseFront.html.twig' %}

{% block Title %}catalog{% endblock %}
{% block link %}
    {#    <link rel="stylesheet" type="text/css" href="{{ asset('catalogue/style.css') }}">#}


{% endblock %}




{% block style %}
    <style>


        .love {
            padding: 0.5rem 1.0rem;
            color: black;
            opacity: 1;
            position: absolute;
            margin: 3.8rem;
            /*margin-top: -10px;*/
        }

        .form {
            width: 800px;
        }

        @media only screen and (max-width: 950px) {
            .form {
                float: none;
                width: 100%;
            }
        }

        @media only screen and (max-width: 950px) {
            .card-col {
                float: none;
                font-size: small;
            }
        }

        .book-img {
            position: relative;
            padding: 0em;
            margin: auto;
        }

        .price {
            color: var(--price_color);
            font-size: smaller;
        }

        .page-link {
            background-color: transparent;
        }

        .page-link:active {
            background-color: red;

        }

        .page-item:active {
            background-color: red;
        }

        .sc {
            color: var(--nav_color);
            border-color: lightgrey
        }

        .card_text {
            font-size: 15px;
            color: grey;
        }


        .hearticon {
            font-size: 18px;
            color: lightgrey;
        }

        .sortable {
            font-size: smaller;
            color: black;
            background-color: transparent;
        }


        .sortable:hover {
            font-size: medium;
            color: var(--nav_backcolor);
        }

        .hearticon:hover {

            color: #e60000;
        }

        a.js-link {
            font-size: medium;
        }

        .cardbutton {
            font-size: smaller;
            background-color: var(--cardbutton_color);
            width: 90%;
        }

        .col .card .book-img:hover {
            opacity: 0.15;
        }

        input[type="range"] {
            width: 100%;
            height: 28px;
            -webkit-appearance: none; /*remove the line*/
            outline: none;
            border: 0; /*for firefox on android*/
            padding: 0 8px; /*for IE*/
            margin: 8px 0;
        }

        /*chrome and opera*/
        input[type="range"]::-webkit-slider-runnable-track {
            background: #ccc; /*trackColor*/
            height: 4px; /*trackHeight*/
            border-radius: 4px; /*trackHeight*/
            transition: 0.3s;
        }

        input[type="range"]:hover::-webkit-slider-runnable-track,
        input[type="range"]:focus::-webkit-slider-runnable-track {
            background: #777; /*activeTrackColor*/
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            background: linear-gradient(to bottom, #71c6b2 20%, #83bed0 80%); /*thumbColor*/
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-top: -8px;
            cursor: pointer;
            border: 4px solid #fff;
            transition: 0.3s;
        }

        input[type="range"]:hover::-webkit-slider-thumb,
        input[type="range"]:focus::-webkit-slider-thumb {
            background: #b6e2e2; /*activeThumbColor*/
        }

        /*firefox*/
        input[type="range"]::-moz-focus-outer {
            border: 0;
        }

        input[type="range"]::-moz-range-track {
            background: #ccc; /*trackColor*/
            height: 4px; /*trackHeight*/
            border-radius: 4px; /*trackHeight*/

        }

        input[type="range"]:hover::-moz-range-track,
        input[type="range"]:focus::-moz-range-track {
            background: #777; /*activeTrackColor*/
        }

        input[type="range"]::-moz-range-thumb {
            background: linear-gradient(to bottom, #71c6b2 20%, #83bed0 80%); /*thumbColor*/
            width: 20px; /*thumbHeight*/
            height: 20px; /*thumbHeight*/
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid #fff;
        }

        input[type="range"]:hover::-moz-range-thumb,
        input[type="range"]:focus::-moz-range-thumb {
            background: #b6e2e2; /*activeThumbColor*/
        }

        input[type="range"]::-moz-range-progress {
            background: var(--nav_color); /*thumbColor*/
            border-radius: 4px; /*trackHeight*/
            height: 4px; /*trackHeight*/
        }

        input[type="range"]:hover::-moz-range-progress,
        input[type="range"]:focus::-moz-range-progress {
            background: #b6e2e2; /*activeThumbColor*/
        }

        /*edge and IE*/
        input[type="range"]::-ms-track {
            background: #ccc; /*trackColor*/
            height: 4px; /*trackHeight*/
            border-radius: 4px; /*trackHeight*/
            border: none;
            color: transparent;
        }

        input[type="range"]:hover::-ms-track,
        input[type="range"]:focus::-ms-track {
            background: #777; /*activeTrackColor*/
        }

        input[type="range"]::-ms-thumb {
            background: var(--nav_color); /*thumbColor*/
            width: 20px; /*thumbHeight*/
            height: 20px; /*thumbHeight*/
            border-radius: 50%;
            border: none;
            margin: 0 4px 0; /*0 thumbBorderWidth 0*/
            box-shadow: 0 0 0 4px #fff;
        }

        input[type="range"]:hover::-ms-thumb,
        input[type="range"]:focus::-ms-thumb {
            background: #b6e2e2; /*activeThumbColor*/
        }

        input[type="range"]::-ms-tooltip {
            display: none; /*tooltip makes thumb sliding lagy*/
        }

        input[type="range"]::-ms-fill-lower {
            background: var(--nav_color); /*thumbColor*/
            border-radius: 4px; /*trackHeight*/
        }

        input[type="range"]:hover::-ms-fill-lower,
        input[type="range"]:focus::-ms-fill-lower {
            background: #b6e2e2; /*activeThumbColor*/
        }

        .form-control::placeholder {
            font-size: 15px;
        }

        .form-control {
            font-size: 17px;
        }

        .card {
            margin-bottom: 18px;
        }


    </style>
{% endblock %}
{% block body %}


    <div style="height: 40px;"></div>
    <div class="container">
        <div class="row">

            <div class="col-6 panel-group ">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h5 class="panel-title">
                            <button class="btn btn-white hover "
                                    data-toggle="collapse" href="#collapse1">
                                <i class="fas fa-sliders-h small"></i> Filter
                            </button>
                        </h5>
                    </div>
                    <div id="collapse1" class="panel-collapse  collapse ">

                        <form class="form">
                            {{ form_start(form) }}
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="float-left small">Author :</label>
                                    {{ form_row(form.author) }}
                                </div>

                                <hr>

                                <div class="col-md-4 slider">
                                    <label class="float-left small">Price</label>
                                    <small class="float-right font-weight ml-2 mt-1 valuespan"></small>
                                    {{ form_row(form.maxPrice) }}
                                </div>
                                <div class="col-2">

                                </div>
                            </div>
                            <hr>

                            <div class="row">
                                <div class="col-4">
                                    <label class="float-left small">Categories :</label><br>
                                    {{ form_row(form.categories) }}
                                </div>
                                <div class="col-4">
                                    <label class="float-left small">Language :</label><br>
                                    {{ form_row(form.languages) }}
                                </div>
                            </div>

                            <hr>
                            <div class="form">
                                <div class="col">
                                    <button type="submit" class="btn sc btn-sm">Search</button>
                                </div>
                            </div>
                            {{ form_end(form) }}

                        </form>

                    </div>
                </div>
            </div>


            <div class="col-6">
                <div class="dropdown float-right">
                    <button class="btn btn-white dropdown-toggle" type="button" id="dropdownMenuButton"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Sort By
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <p class="container">{{ knp_pagination_sortable(filtre , "price" , "p.prix") }} <i
                                    class="fas fa-sort-amount-up small "></i></p>
                        <p class="container">{{ knp_pagination_sortable(filtre , "price" , "p.prix", ['desc']) }}<i
                                    class="fas fa-sort-amount-down small "></i></p>
                        <p class="container"> {{ knp_pagination_sortable(filtre , "Newest" , "p.date_pub" , ['desc'] ) }}</p>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <br>

    <!--style="color:#6d2e3e"-->
    <br>
    <div class="container-fluid ">
        <div class="row">
            {% if filtre is empty %}
                <div class="container" style="height:80px">
                    <div class="row">
                        <div class="col-12">
                            <p class="text-center"> Sorry we don't have books with this features <i
                                        class="far fa-frown"></i></p>
                        </div>
                    </div>
                </div>
            {% else %}
                {% for livre in filtre %}
                    <div class="col card-col">
                        <div class="card " id="{{ livre.id }}" style="width: 11rem; ">
                            <i style="font-size:70% " class="fas fa-heart disabled love"><span
                                        class="js-like small"> {{ livre.Likes | length }}</span></i>
                            <a href="/livre/{{ livre.id }}"> <img src="{{ livre.path }}" class="book-img  card-img-top"
                                                                  alt="..." style="width:100%"></a>

                            <div class="card-body">
                                <p class="card-title" style="font-size:75%">{{ livre.nomLivre }}
                                    <a class="js-like " href="/livre/{{ livre.id }}/like">
                                        {% if app.user and livre.isLiked(app.user) %}
                                            <i style="font-size:70%;  " class="fas fa-heart text-danger hearticon"
                                               data-toggle="tooltip" data-placement="bottom" title="Unlove this book">
                                            </i>

                                        {% else %}
                                            <i style="font-size:70%" class="fas fa-heart hearticon"
                                               data-toggle="tooltip"
                                               data-placement="bottom" title="love this book">
                                            </i>

                                        {% endif %}
                                    </a>
                                </p>
                                <p class="card-text price" style="font-size:70%"><b>{{ livre.prix }} Dt</b>
                                <p class="card-text card_text" style="font-size:60%">By {{ livre.auteur }} </p>
                                <button class="btn shadow-sm cardbutton" data-id="{{ livre.id }}" style="font-size:70%">
                                    Add to Cart
                                    <i
                                            class="fas fa-shopping-cart  icon"
                                            style="font-size:11px;"> </i></button>
                            </div><!--ffb84d-->
                        </div>

                    </div>

                {% endfor %}
            {% endif %}
        </div>
        <br>
        <div class="container">
            <div class="row">
                <div class="col-7">
                    <nav class="float-right " aria-label=" shadow Page">
                        {{ knp_pagination_render(filtre) }}

                    </nav>
                </div>

            </div>
        </div>

    </div>



{% endblock %}
{% block javascripts %}
    <script>
        $(document).ready(function () {
            const $valueSpan = $('.valuespan');
            const $value = $('#maxPrice');
            $valueSpan.html("0-" + $value.val() + "dt");
            $value.on('input change', () => {
                $valueSpan.html("0-" + $value.val() + "dt");
            });
        });


    </script>
    <script>
        $(document).ready(function (e) {
            $('.active').css('background-color', 'lightgrey');
            $('.active').removeClass('active');

        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function onClickBtnLike(event) {
            event.preventDefault();
            const url = this.href;
            const like = document.querySelector('span.js-like');
            const icon = this.querySelector('i.hearticon')
            console.log(like);
            axios.get(url).then(function (response) {
                like.textContent = response.data.likes;
                console.log(like);
                if (icon.classList.contains('text-danger')) icon.classList.remove('text-danger');
                else icon.classList.add('text-danger');
            });
        }

        document.querySelectorAll('.js-like').forEach(function (link) {
            link.addEventListener('click', onClickBtnLike);
        })</script>



{% endblock %}
